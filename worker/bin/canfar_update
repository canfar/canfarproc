#!/bin/bash

EXEC_NAME=$(basename $0 .${0##*.})
EXEC_VERSION=0.2.3

msg() {
    echo -e " >> ${EXEC_NAME}: $1"
}

die() {
    echo -e " !! ERROR ${EXEC_NAME}: $1" 1>&2
    exit 1
}

usage() {
    echo $"Usage: ${EXEC_NAME}
Update CANFAR specific scripts and CADC web service clients
"
    exit
}

GITURL="https://github.com/canfar/canfarproc/raw/master/worker/bin"

[[ ${EUID} -ne 0 ]] && die "you must run this script as root or with sudo"

SCRIPTS="canfar_batch_prepare canfar_create_user cadc_dotnetrc cadc_cert canfar_update canfar_setup_scratch"

for script in ${SCRIPTS} ; do
    msg "updating ${script}"
    curl -sL ${GITURL}/${script} -o ${script}
    install -c ${script} /usr/local/bin
    rm ${script}
done

msg "updating CADC clients"

# cadc clients do not work with python < 2.7
# redhat-6 based distros have python-2.6
# so hack for centos6, assuming python27-pip from ius repo is installed
PIP=pip
grep -q CentOS.*6.  /etc/redhat-release 2> /dev/null && PIP=pip2.7

# centos7 has now python3
grep -q CentOS.*7.  /etc/redhat-release 2> /dev/null && PIP=pip3.6

# install stuff for ubuntu-18 (bionic) for python3
grep -q bionic  /etc/os-release 2> /dev/null && PIP=pip3

${PIP} install --upgrade vos vofs cadcutils cadcdata cadctap
