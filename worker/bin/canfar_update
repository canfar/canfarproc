#!/bin/bash

EXEC_NAME=$(basename $0 .${0##*.})
EXEC_VERSION=0.1.4

msg() {
    echo -e " >> ${EXEC_NAME}: $1"
}

die() {
    echo -e " >> ${EXEC_NAME} ERROR: $1" 1>&2
    exit 1
}

usage() {
    echo $"Usage: ${EXEC_NAME}
Update CANFAR specific scripts and web service clients
"
    exit
}

GITURL="https://github.com/canfar/canfarproc/raw/master/worker/bin"

[[ ${EUID} -ne 0 ]] && die "you must run this script as root or with sudo"

SCRIPTS="batch_prepare create_user dotnetrc cert update setup_scratch"

for script in ${SCRIPTS} ; do
    cs=canfar_${script}
    msg "updating ${cs}"
    curl -sL ${GITURL}/${cs} -o ${cs}
    install -c ${cs} /usr/local/bin
    rm ${cs}
done

msg "updating CADC clients"

# cadc clients do not work with python < 2.7
# redhat-6 based distros have python-2.6
# so hack for centos6, assuming python27-pip from ius repo is installed
PIP=pip
grep -q CentOS.*6.  /etc/redhat-release 2> /dev/null && PIP=pip2.7

${PIP} install --upgrade cadcutils vos vofs cadcdata
